
'use strict';(function(){var CONFIG={id:{widgetTemplate:'widget-template',widgetIconTemplate:'widget-icon-template',itemTemplate:'item-template',widget:'widget',widgetIcon:'widget-icon',widgetIconCounter:'widget-icon-counter',list:'list',article:'article-',articleLink:'articleLink-',btnClose:'btn-close'},"class":{hide:'hide',widget:'widget',widgetIcon:'widget-icon',widgetIconCounter:'widget-icon__counter',item:'item',article:'article',articleHeader:'article__header',articleInfo:'article__info',articleIcon:'article__icon',articleDatetime:'article__datetime',articleAuthor:'article__author',articleLink:'article__link'},regexp:{articleLinkId:/^articleLink-\d+$/},timeout:5000,status:{ok:200},msg:{fail:'Something went wrong...',error:'Network related problem occured',timeout:'Request exceeded the maximum time limit'},url:{news:'https://raw.githubusercontent.com/akzhar/news-widget/main/src/data/news.json',fonts:'https://fonts.googleapis.com/css2?family=Oswald&display=swap',styles:'css/widget.min.css',svg:'img/sprite.min.svg',templates:'templates.html'}};window.exports={CONFIG:CONFIG};})();"use strict";(function(){var CONFIG=window.exports.CONFIG;var reject=function reject(msg){alert(msg);throw new Error(msg);};var getRequest=function getRequest(url,contentType,resolve){var xhr=new XMLHttpRequest();xhr.open('GET',url);xhr.setRequestHeader('Content-Type',contentType);xhr.timeout=CONFIG.timeout;xhr.addEventListener('error',function(){return reject(CONFIG.msg.error);});xhr.addEventListener('timeout',function(){return reject(CONFIG.msg.timeout);});xhr.addEventListener('load',function(){if(xhr.status!=CONFIG.status.ok)reject("".concat(CONFIG.msg.fail,"\n").concat(xhr.status,": ").concat(xhr.statusText));resolve(xhr.responseText);});return xhr;};window.exports.xhr={getRequest:getRequest};})();"use strict";(function(){var CONFIG=window.exports.CONFIG;var xhr=window.exports.xhr;var loadStyles=function loadStyles(){var link=document.createElement('link');link.rel='stylesheet';link.href=CONFIG.url.styles;document.head.appendChild(link);};var loadFonts=function loadFonts(){var style=document.createElement('style');style.textContent="@import url(\"".concat(CONFIG.url.fonts,"\");");document.head.appendChild(style);};var onSpriteLoad=function onSpriteLoad(data){var div=document.createElement('div');div.classList.add(CONFIG["class"].hide);div.innerHTML=data;document.body.appendChild(div);};var onTemplatesLoad=function onTemplatesLoad(data){var div=document.createElement('div');div.classList.add(CONFIG["class"].hide);div.id='templates';div.innerHTML=data;document.body.appendChild(div);};var load=function load(cb){loadStyles();loadFonts();xhr.getRequest(CONFIG.url.svg,'text/plain',onSpriteLoad).send();xhr.getRequest(CONFIG.url.templates,'text/plain',function(data){onTemplatesLoad(data);xhr.getRequest(CONFIG.url.news,'application/json',function(data){cb(data);}).send();}).send();};window.exports.loader={load:load};})();"use strict";(function(){var CONFIG=window.exports.CONFIG;var updateWidgetIcon=function updateWidgetIcon(unreadCount){var iconElem=document.querySelector("#".concat(CONFIG.id.widgetIcon));var counter=iconElem.querySelector("#".concat(CONFIG.id.widgetIconCounter));if(unreadCount){iconElem.title="You have ".concat(unreadCount," unread news");counter.textContent=unreadCount;}else{iconElem.title='You have no unread news yet';iconElem.classList.remove("".concat(CONFIG["class"].widgetIcon,"--animate"));counter.classList.add("".concat(CONFIG["class"].widgetIconCounter,"--hide"));}};var markArticleAsRead=function markArticleAsRead(articleId){var article=document.querySelector(articleId);var readIcon=article.querySelector(".".concat(CONFIG["class"].articleIcon,"--read"));article.classList.add("".concat(CONFIG["class"].article,"--read"));readIcon.classList.add("".concat(CONFIG["class"].articleIcon,"--read--show"));};var showWidget=function showWidget(){document.querySelector("#".concat(CONFIG.id.widgetIcon)).classList.remove("".concat(CONFIG["class"].widgetIcon,"--show"));document.querySelector("#".concat(CONFIG.id.widget)).classList.add("".concat(CONFIG["class"].widget,"--show"));};var hideWidget=function hideWidget(){document.querySelector("#".concat(CONFIG.id.widgetIcon)).classList.add("".concat(CONFIG["class"].widgetIcon,"--show"));document.querySelector("#".concat(CONFIG.id.widget)).classList.remove("".concat(CONFIG["class"].widget,"--show"));};var renderUsingTemplates=function renderUsingTemplates(news){var iconTemplate=document.querySelector("#".concat(CONFIG.id.widgetIconTemplate));var iconElem=iconTemplate.content.querySelector(".".concat(CONFIG["class"].widgetIcon)).cloneNode(true);var counter=iconElem.querySelector("#".concat(CONFIG.id.widgetIconCounter));iconElem.title="You have ".concat(news.length," unread news");counter.textContent=news.length;var widgetTemplate=document.querySelector("#".concat(CONFIG.id.widgetTemplate));var widgetElem=widgetTemplate.content.querySelector(".".concat(CONFIG["class"].widget)).cloneNode(true);var newsList=widgetElem.querySelector("#".concat(CONFIG.id.list));var itemTemplate=document.querySelector("#".concat(CONFIG.id.itemTemplate));var itemCard=itemTemplate.content.querySelector(".".concat(CONFIG["class"].item));news.forEach(function(newsItem,index){var itemElem=itemCard.cloneNode(true);var newsElem=getNewsElemUsingTemplates(newsItem,index,itemElem);newsList.appendChild(newsElem);});document.body.appendChild(iconElem);document.body.appendChild(widgetElem);};var getNewsElemUsingTemplates=function getNewsElemUsingTemplates(newsItem,index,newsElem){var article=newsElem.querySelector(".".concat(CONFIG["class"].article));var number=article.querySelector(".".concat(CONFIG["class"].articleIcon,"--number > span"));var header=article.querySelector(".".concat(CONFIG["class"].articleHeader));var info=article.querySelector(".".concat(CONFIG["class"].articleInfo));var link=article.querySelector(".".concat(CONFIG["class"].articleLink));var datetime=info.querySelector(".".concat(CONFIG["class"].articleDatetime));var author=info.querySelector(".".concat(CONFIG["class"].articleAuthor));number.textContent=index+1;header.innerHTML=newsItem.title;datetime.textContent=newsItem.datetime;author.textContent=newsItem.author;link.href=newsItem.link;link.id="".concat(CONFIG.id.articleLink).concat(index);article.id="".concat(CONFIG.id.article).concat(index);return newsElem;};var renderWidget=function renderWidget(news){var iconElem="<div class=\"widget-icon widget-icon--show widget-icon--animate\" id=\"widget-icon\" title=\"You have ".concat(news.length," unread news\">\n\t\t\t<output class=\"widget-icon__counter\" id=\"widget-icon-counter\">").concat(news.length,"</output>\n\t\t\t<svg width=\"14\" height=\"14\">\n\t\t\t\t<use xlink:href=\"#bell\"></use>\n\t\t\t</svg>\n\t\t</div>");var widgetElem="<div class=\"widget\" id=\"widget\">\n\t\t\t<ul class=\"widget__list list\" id=\"list\">".concat(getListOfItems(news),"</ul>\n\t\t\t<button class=\"btn-close\" id=\"btn-close\" aria-label=\"Close widget button\" title=\"Close widget\"></button>\n\t\t</div>");document.body.innerHTML+=iconElem;document.body.innerHTML+=widgetElem;};var getListOfItems=function getListOfItems(news){return news.reduce(function(newsList,newsItem,index){return newsList+getItemElem(newsItem,index);},'');};var getItemElem=function getItemElem(newsItem,index){var itemElem="<li class=\"list__item item\">\n\t\t\t<div class=\"item__wrapper\">\n\t\t\t\t<article class=\"article\" id=\"".concat(CONFIG.id.article).concat(index,"\">\n\t\t\t\t\t<div class=\"article__icon article__icon--number\"><span>").concat(index+1,"</span></div>\n\t\t\t\t\t<div class=\"article__icon article__icon--read\" title=\"Read\">\n\t\t\t\t\t\t<svg width=\"14\" height=\"14\">\n\t\t\t\t\t\t\t<use xlink:href=\"#view\"></use>\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t</div>\n\t\t\t\t\t<header class=\"article__header\">").concat(newsItem.title,"</header>\n\t\t\t\t\t<div class=\"article__info\">\n\t\t\t\t\t\t<div class=\"article__icon\" title=\"Published\">\n\t\t\t\t\t\t\t<svg width=\"14\" height=\"14\">\n\t\t\t\t\t\t\t\t<use xlink:href=\"#clock\"></use>\n\t\t\t\t\t\t\t</svg></div>\n\t\t\t\t\t\t<datetime class=\"article__datetime\">").concat(newsItem.datetime,"</datetime>\n\t\t\t\t\t\t<div class=\"article__icon\" title=\"Author\">\n\t\t\t\t\t\t\t<svg width=\"14\" height=\"14\">\n\t\t\t\t\t\t\t\t<use xlink:href=\"#user\"></use>\n\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<span class=\"article__author\">").concat(newsItem.author,"</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<a class=\"article__link\" href=\"").concat(newsItem.link,"\" target=\"_blank\" id=\"").concat(CONFIG.id.articleLink).concat(index,"\">\u041F\u043E\u0434\u0440\u043E\u0431\u043D\u0435\u0435</a>\n\t\t\t\t</article>\n\t\t\t</div>\n\t\t</li>");return itemElem;};var removeTemplates=function removeTemplates(){var templates=document.querySelector('#templates');templates.parentNode.removeChild(templates);};window.exports.render={renderUsingTemplates:renderUsingTemplates,renderWidget:renderWidget,removeTemplates:removeTemplates,updateWidgetIcon:updateWidgetIcon,markArticleAsRead:markArticleAsRead,hideWidget:hideWidget,showWidget:showWidget};})();"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}
function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}
function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor;}
(function(){var CONFIG=window.exports.CONFIG;var loader=window.exports.loader;var _render=window.exports.render;var Widget=function(){function Widget(){_classCallCheck(this,Widget);}
_createClass(Widget,[{key:"contructor",value:function contructor(){this._news=undefined;this._unreadCount=undefined;}},{key:"init",value:function init(){var onLoad=this.onLoad.bind(this);loader.load(onLoad);}},{key:"onLoad",value:function onLoad(data){debugger;var news=JSON.parse(data);this.news=news;this.unreadCount=news.length;this.render();this.addListeners();}},{key:"render",value:function render(){if('content'in document.createElement('template')){_render.renderUsingTemplates(this.news);}else{_render.renderWidget(this.news);_render.removeTemplates(this.news);}}},{key:"addListeners",value:function addListeners(){var _this=this;document.querySelector("#".concat(CONFIG.id.widgetIcon)).addEventListener('click',this.show);document.querySelector("#".concat(CONFIG.id.btnClose)).addEventListener('click',this.hide);document.querySelector("#".concat(CONFIG.id.list)).addEventListener('click',function(evt){if(evt.target.tagName==='A'&&CONFIG.regexp.articleLinkId.test(evt.target.id))_this.onArticleLinkClick(evt.target.id);});window.addEventListener('keydown',function(evt){if(evt.key==='Escape'||evt.key==='Esc')_this.hide();});}},{key:"onArticleLinkClick",value:function onArticleLinkClick(linkId){var id=Widget.getNewsIdByArticleLinkId(linkId);if(!this.news[id].isRead){this.news[id].isRead=true;this.unreadCount--;var articleId=Widget.getArticleIdByNewsId(id);_render.markArticleAsRead(articleId);_render.updateWidgetIcon(this.unreadCount);}}},{key:"show",value:function show(){_render.showWidget();}},{key:"hide",value:function hide(){_render.hideWidget();}},{key:"news",get:function get(){return this._news;},set:function set(value){this._news=value;}},{key:"unreadCount",get:function get(){return this._unreadCount;},set:function set(value){this._unreadCount=value;}}],[{key:"getNewsIdByArticleLinkId",value:function getNewsIdByArticleLinkId(id){return+id.slice(id.indexOf('-')+1,id.length);}},{key:"getArticleIdByNewsId",value:function getArticleIdByNewsId(id){return"#".concat(CONFIG.id.article).concat(id);}}]);return Widget;}();window.exports.Widget=Widget;})();"use strict";var widget=new window.exports.Widget();widget.init();